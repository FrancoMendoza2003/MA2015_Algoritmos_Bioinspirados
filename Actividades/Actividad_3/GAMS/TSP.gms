$title TSP
Sets
i index /1*41/;
alias (i,j);
sets offdiag1(i,j)
     offdiag2(i,j);
offdiag1(i,j)=yes;
offdiag1(i,i)=no;
offdiag2(i,j)=offdiag1(i,j);
offdiag2(i,'1')=no;
offdiag2('1',j)=no;

table
t(i,j)
    1       2       3       4       5       6       7       8       9       10      11      12      13      14      15      16      17      18      19      20      21      22      23      24      25      26      27      28      29      30      31      32      33      34      35      36      37      38      39      40      41      
1   999     70      70      57      58.3    52      122     116     17      17      15      15      21      17      10      11      13      15      14      16      11      49      64      18      28      43      24      83      57      126     17      11      23      20      22      21      20      18      19      17      19      
2   70      999     2       94      93      88      148     145     112     108     102     109     95      107     89      89      88      95      86      89      91      27      102     112     71      103     106     15      92      145     98      84      94      91      94      100     99      91      90      94      83      
3   70      2       999     101     101     93      156     153     89      91      89      90      91      90      78      73      73      79      71      71      73      27      107     90      72      86      88      14      95      150     91      79      87      82      86      85      87      87      87      85      88      
4   57      94      101     999     9       17      108     105     54      67      64      59      67      58      60      58      59      64      60      61      57      92      6       46      66      72      64      112     16      102     60      60      65      61      60      60      60      61      61      60      61      
5   58.3    93      101     9       999     12      113     110     54      66      64      59      67      59      60      58      59      63      61      62      58      91      13      47      66      70.9    63      115     7       107     60      60      65      60      60      58      60      62      62      59      60      
6   52      88      93      17      12      999     121     118     48      58      59      57      59      53      57      54      54      58      56      58      53      85      22      41      61      66      56      110     6       116     57      54      58      54      55      56      58      57      57      54      57      
7   122     148     156     108     113     121     999     17      135     132     130     131     131     132     124     123     121     124     123     124     123     150     102     127     128     139     130     161     112     15      132     126     131     127     128     133     132     131     131     130     131     
8   116     145     153     105     110     118     17      999     128     126     124     125     126     126     119     118     116     118     117     118     117     144     94      122     122     132     124     154     107     2       126     120     125     121     122     128     126     125     125     123     125     
9   17      112     89      54      54      48      135     128     999     14      12      9       16      6       13      15      16      21      19      20      15      49      53.9    10      25      20      14      75      46      129     10      12      13      10      8       8       9       10      9       8       9       
10  17      108     91      67      66      58      132     126     14      999     4       8       4       9       9       12      11      12      15      16      13      48      60      19      16      17      4       72      53      129     10      7       2       5       6       10      10      9       9       6       9   
11  15      102     89      64      64      59      130     124     12      4       999     6       6       7       8       10      10      13      13      14      11      46      59      17      17      17      5       71      52      126     8       5       4       2       4       8       8       9       7       4       7   
12  15      109     90      59      59      57      131     125     9       8       6       999     9       5       5       8       7       12      10      12      8       43      55      16      16      18      7       70      49      124     4       5       8       2       4       5       4       2       2       4       1   
13  21      95      91      67      67      59      131     126     16      4       6       9       999     13      13      17      17      13      18      20      16      57      79      25      19      21      2       80      64      135     13      11      4       8       10      14      13      12      12      10      12  
14  17      107     90      58      59      53      132     126     6       9       7       5       13      999     7       10      10      16      16      15      11      50      70      15      21      22      9       76      55      131     2       6       8       4       2       2       3       3       3       2       3   
15  10      89      78      60      60      57      124     119     13      9       8       5       13      7       999     5       4       10      8       10      6       47      76      19      15      28      10      68      61      126     12      4       12      7       9       13      11      11      11      11      10  
16  11      89      73      58      58      54      123     118     15      12      10      8       17      10      5       999     3       10      8       9       3       46      76      19      14      31      15      69      64      126     17      8       21      15      16      16      15      16      16      18      16  
17  13      88      73      59      59      54      121     116     16      11      10      7       17      10      4       3       999     8       5       7       4       45      78      21      11      28      13      72      64      123     15      9       17      15      18      23      15      16      15      17      16  
18  15      95      79      64      63      58      124     118     21      12      13      12      13      16      10      10      8       999     8       9       11      48      81      24      8       25      12      73      69      123     24      15      16      19      19      25      25      23      23      22      22  
19  14      86      71      60      61      56      123     117     19      15      13      10      18      16      8       8       5       8       999     4       7       43      79      24      9       28      16      70      66      125     21      12      19      17      17      26      20      20      20      20      19  
20  16      89      71      61      62      58      124     118     20      16      14      12      20      15      10      9       7       9       4       999     11      45      77      25      11      31      20      69      63      147     25      15      23      22      22      29      26      25      25      26      25  
21  11      91      73      57      58      53      123     117     15      13      11      8       16      11      6       3       4       11      7       11      999     47      71      19      13      30      14      72      57      149     19      9       19      13      15      19      19      17      17      18      18  
22  49      27      27      92      91      85      150     144     49      48      46      43      57      50      47      46      45      48      43      45      47      999     114     54      42      55      59      34      94      159     64      57      61      60      61      66      66      65      64      66      64  
23  64      102     107     6       13      22      102     94      53.9    60      59      55      79      70      76      76      78      81      79      77      71      114     999     49      76      72      72      103     20      101     70      67      76      69      69      69      68      70      69      68      70  
24  18      112     90      46      47      41      127     122     10      19      17      16      25      15      19      19      21      24      24      25      19      54      49      999     32      41      28      76      44      144     22      18      28      23      20      20      20      20      20      18      20  
25  28      71      72      66      66      61      128     122     25      16      17      16      19      21      15      14      11      8       9       11      13      42      76      32      999     26      20      76      76      163     34      23      22      27      27      37      34      34      34      32      31  
26  43      103     86      72      70.9    66      139     132     20      17      17      18      21      22      28      31      28      25      28      31      30      55      72      41      26      999     20      84      71      165     30      28      20      23      29      32      29      30      30      24      29  
27  24      106     88      64      63      56      130     124     14      4       5       7       2       9       10      15      13      12      16      20      14      59      72      28      20      20      999     89      74      165     13      7       7       10      10      15      15      14      14      14      14  
28  83      15      14      112     115     110     161     154     75      72      71      70      80      76      68      69      72      73      70      69      72      34      103     76      76      84      89      999     92      150     100     90      93      92      95      101     101     100     100     100     101 
29  57      92      95      16      7       6       112     107     46      53      52      49      64      55      61      64      64      69      66      63      57      94      20      44      76      71      74      92      999     116     63      59      67      61      60      60      62      62      62      58      62  
30  126     145     150     102     107     116     15      2       129     129     126     124     135     131     126     126     123     123     125     147     149     159     101     144     163     165     165     150     116     999     150     135     145     141     142     143     149     147     146     145     147 
31  17      98      91      60      60      57      132     126     10      10      8       4       13      2       12      17      15      24      21      25      19      64      70      22      34      30      13      100     63      150     999     6       11      4       6       7       4       3       3       5       3   
32  11      84      79      60      60      54      126     120     12      7       5       5       11      6       4       8       9       15      12      15      9       57      67      18      23      28      7       90      59      135     6       999     12      6       7       10      8       8       8       8       8   
33  23      94      87      65      65      58      131     125     13      2       4       8       4       8       12      21      17      16      19      23      19      61      76      28      22      20      7       93      67      145     11      12      999     6       9       15      13      14      14      9       14  
34  20      91      82      61      60      54      127     121     10      5       2       2       8       4       7       15      15      19      17      22      13      60      69      23      27      23      10      92      61      141     4       6       6       999     1       11      9       10      10      3       10  
35  22      94      86      60      60      55      128     122     8       6       4       4       10      2       9       16      18      19      17      22      15      61      69      20      27      29      10      95      60      142     6       7       9       1       999     7       6       8       8       4       8   
36  21      100     85      60      58      56      133     128     8       10      8       5       14      2       13      16      23      25      26      29      19      66      69      20      37      32      15      101     60      143     7       10      15      11      7       999     8       8       8       7       9   
37  20      99      87      60      60      58      132     126     9       10      8       4       13      3       11      15      15      25      20      26      19      66      68      20      34      29      15      101     62      149     4       8       13      9       6       8       999     5       5       2       6   
38  18      91      87      61      62      57      131     125     10      9       9       2       12      3       11      16      16      23      20      25      17      65      70      20      34      30      14      100     62      147     3       8       14      10      8       8       5       999     6       2       6   
39  19      90      87      61      62      57      131     125     9       9       7       2       12      3       11      16      15      23      20      25      17      64      69      20      34      30      14      100     62      146     3       8       14      10      8       8       5       6       999     3       1   
40  17      94      85      60      59      54      130     123     8       6       4       4       10      2       11      18      17      22      20      26      18      66      68      18      32      24      14      100     58      145     5       8       9       3       4       7       2       2       3       999     4   
41  19      83      88      61      60      57      131     125     9       9       7       1       12      3       10      16      16      22      19      25      18      64      70      20      31      29      14      101     62      147     3       8       14      10      8       9       6       6       1       4       999;   



Scalar n;
n=card(i);

Variables f, y;

binary variable x;

Equations
ohr1(j)
ohr2(i)
anti(i,j)
ucel;

ucel.. f=e=sum((i,j),t(i,j)*x(i,j));
ohr1(j).. sum(i,x(i,j)$offdiag1(i,j))=e=1;
ohr2(i).. sum(j,x(i,j)$offdiag1(i,j))=e=1;
anti(offdiag2(i,j)).. y(i)-y(j)+n*x(i,j)=l=n-1;

model TSP2 /all/;
Solve TSP2 using mip minimizing f;


